var push = {
	submit : function(ele) {
		var pushUid = $("#pushUid").val();
        var payCoinId = $("#payCoinId").val();
		var pushCoinId = $("#pushCoinId").val();
		var pushCount = $("#pushCount").val();
		var pushPrice = $("#pushPrice").val();
		var btcbalance = $("#btcbalance").val();
		var phoneCode = "";
		var googleCode = "";
		if (pushUid == "") {
            util.layerAlert("",util.getLan("finance.tips.41"),2);
			return;
		}
        var reg = new RegExp("^[0-9]*$");
        if(!reg.test(pushUid)){
            util.layerAlert("",util.getLan("finance.tips.48"),2);
            return;
        }
		if (pushCoinId == "") {
            util.layerAlert("", util.getLan("finance.tips.33"),2);
			return;
		}
        if (pushPrice == "") {
            util.layerAlert("", util.getLan("finance.tips.37"),2);
            return;
        }
        if (Number(pushPrice) < 0.000001) {
            util.layerAlert("", util.getLan("finance.tips.38"),2);
            return;
        }
		if (pushCount == "") {
            util.layerAlert("", util.getLan("finance.tips.34"),2);
			return;
		}
		if (Number(pushCount) < 1) {
            util.layerAlert("", util.getLan("finance.tips.35"),2);
			return;
		}
		if (Number(btcbalance) < Number(pushCount)) {
            util.layerAlert("", util.getLan("finance.tips.36"),2);
			return;
		}

		var url = "/submit_push.html";
		var param = {
			pushcoinid : pushCoinId,
            paycoinid : payCoinId,
			pushuid : pushUid,
			pushcount : pushCount,
			pushprice : pushPrice,
            tradepwd : '',
			phonecode : phoneCode,
			googlecode : googleCode,
		}
		var callback = function(result) {
			if (result.code == 200) {
				util.layerAlert("", result.msg, 1);
			} else {
                util.layerAlert("", result.msg,2);
			}
		}
		util.network({btn : ele,url : url,param : param,success : callback});
	},
	cancel : function(pushid) {
		util.layerConfirm(util.getLan("finance.tips.40"), function() {
			var url = "/cancel_push.html";
			var param = {
				pushid : pushid
			};
			var callback = function(result) {
				if (result.code == 200) {
					util.layerAlert("", result.msg, 1);
				} else {
                    util.layerAlert("", result.msg, 2);
				}
			};
			util.network({url : url,param : param,success : callback});
		});
	},
    confirmShow: function (ele) {
        var $that = $(ele);
        var $data = $that.data();
        var pushid = $data.pushid;
        var coins = $data.coins;
        var count = $data.count;
        var price = $data.price;
        var amount = $data.amount;
        var content = '<div class="comm-dialog">'
            + '<div class="title">'
            + '<span>'
            + util.getLan("finance.tips.42")
            + '</span><i class="close"></i>'
            + '</div>'
            + '<div class="content">'
            + '<div class="grid-item"><span>' + util.getLan("finance.tips.43")
            + '</span><span>DHG</span></div>'
            + '<div class="grid-item"><span>' + util.getLan("finance.tips.44")
            + '</span><span>' + price + coins + '</span></div>'
            + '<div class="grid-item"><span>' + util.getLan("finance.tips.45")
            + '</span><span>' + count + 'DHG</span></div>'
            + '<div class="grid-item"><span>' + util.getLan("finance.tips.46")
            + '</span><span class="blod">' + amount + coins + '</span></div>'
            + '</div>'
            + '<button class="pay-btn">' + util.getLan("finance.tips.47") + '</button>'
            + '</div>';
        push.layerIndex = layer.open({type: 1, title: false, content: content, area: '7.9rem', closeBtn: 0});
        $(".comm-dialog .close").unbind("click").on("click", function () {
            layer.close(push.layerIndex);
        });
        $(".comm-dialog .pay-btn").unbind("click").on("click", function () {
            push.confirm(this,pushid);
        });
    },
    confirm: function (ele,pushid) {
        var url = "/confirm_push.html";
        var param = {
            pushid: pushid
        };
        var callback = function (result) {
            if (result.code == 200) {
                util.layerAlert("", result.msg, 1);
            } else {
                util.layerAlert("", result.msg, 2);
            }
        };
        util.network({btn: ele,url: url, param: param, success: callback});
    },
    getUserBalance: function (ele) {
        var url = "/push/userbalance.html";
        var param = {coinid: ele.value};
        var callback = function (result) {
            if (result.code === 200) {
                $("#btcbalance").val(result.data.total);
                $("#assettotal").html(result.data.total);
            } else {
                util.layerAlert("", result.msg, 2);
            }
        };
        util.network({btn: ele, url: url, param: param, success: callback});
    }
}
$(function() {
	$("#pushPrice").on("keypress", function(event) {
		return util.goIngKeypress(this, event, util.PUSH_COIN_SCALE);
	}).on("keyup", function(event) {
		var number = $("#pushCount").val();
        if(number && number.length>0){
           $("#txtShowAmount").text(util.numFormat(util.accMul(parseFloat(this.value),parseFloat(number)),4))
        }
        return util.goIngKeypress(this, event, util.PUSH_COIN_SCALE);
    });
	$("#pushCount").on("keypress", function(event) {
		return util.goIngKeypress(this, event, util.PUSH_COIN_SCALE);
	}).on("keyup", function(event) {
        var number = $("#pushPrice").val();
		if(number && number.length>0){
        	$("#txtShowAmount").text(util.numFormat(util.accMul(parseFloat(this.value),parseFloat(number)),4))
        }
        return util.goIngKeypress(this, event, util.PUSH_COIN_SCALE);
    });
	$("#pushSubmit").on("click", function() {
		push.submit(this);
	});
	$(".cancelPush").on("click", function() {
		var $that = $(this);
		push.cancel($that.data().pushid);
	});
	$(".payPush").on("click", function() {
		push.confirmShow(this);
	});
	$("#pushModalBtn").on("click", function() {
		push.confirm(this);
	});
    $("#pushCoinId").on("change", function () {
        push.getUserBalance(this);
    });
});